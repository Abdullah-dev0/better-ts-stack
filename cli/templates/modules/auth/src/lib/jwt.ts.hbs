import jwt from 'jsonwebtoken';

export interface AuthTokenPayload {
  sub: string;
  email: string;
  name?: string | null;
}

const { JWT_SECRET, JWT_EXPIRES_IN } = process.env;

function ensureSecret(): string {
  if (!JWT_SECRET) {
    throw new Error('JWT_SECRET is not set');
  }
  return JWT_SECRET;
}

export function signToken(payload: AuthTokenPayload): string {
  const secret = ensureSecret();
  const expiresIn = JWT_EXPIRES_IN || '1h';
  return jwt.sign(payload, secret, { expiresIn });
}

export function verifyToken(token: string): AuthTokenPayload {
  const secret = ensureSecret();
  return jwt.verify(token, secret) as AuthTokenPayload;
}
