---
title: Auth Module
description: JWT authentication for Express, Better Auth for Next.js
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

## Auth Module Overview

The Auth Module adds authentication to your project, implementing secure user registration and login. The implementation varies based on your stack:

| Stack | Implementation | Features |
|-------|---------------|----------|
| **Express Backend** | JWT tokens | Register, login, protected routes |
| **Next.js Frontend** | Better Auth | OAuth, sessions, magic links |

---

## Express + JWT

For backend-only or full-stack with Express API.

### Generated Files

```
src/
├── lib/
│   └── jwt.ts          # JWT utilities
├── middleware/
│   └── auth.ts         # Auth middleware
├── controllers/
│   └── authController.ts # Auth logic
└── routes/
    └── auth.ts         # Auth routes
```

### JWT Utility

```typescript
// src/lib/jwt.ts
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET!;
const JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '7d';

export function generateToken(payload: object): string {
  return jwt.sign(payload, JWT_SECRET, {
    expiresIn: JWT_EXPIRES_IN
  });
}

export function verifyToken(token: string): any {
  return jwt.verify(token, JWT_SECRET);
}
```

### Auth Middleware

```typescript
// src/middleware/auth.ts
import { Request, Response, NextFunction } from 'express';
import { verifyToken } from '../lib/jwt';

export interface AuthRequest extends Request {
  user?: any;
}

export function authMiddleware(
  req: AuthRequest,
  res: Response,
  next: NextFunction
) {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');
    
    if (!token) {
      return res.status(401).json({
        error: { code: 'UNAUTHORIZED', message: 'No token provided' }
      });
    }

    const decoded = verifyToken(token);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({
      error: { code: 'UNAUTHORIZED', message: 'Invalid token' }
    });
  }
}
```

### Auth Controller

```typescript
// src/controllers/authController.ts
import { Request, Response } from 'express';
import bcrypt from 'bcrypt';
import { prisma } from '../lib/prisma';
import { generateToken } from '../lib/jwt';

const SALT_ROUNDS = 10;

export async function register(req: Request, res: Response) {
  try {
    const { email, password, name } = req.body;

    // Check if user exists
    const existing = await prisma.user.findUnique({ where: { email } });
    if (existing) {
      return res.status(409).json({
        error: { code: 'EMAIL_EXISTS', message: 'Email already registered' }
      });
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);

    // Create user
    const user = await prisma.user.create({
      data: {
        email,
        password: hashedPassword,
        name
      },
      select: {
        id: true,
        email: true,
        name: true,
        createdAt: true
      }
    });

    // Generate token
    const token = generateToken({ userId: user.id });

    res.status(201).json({ user, token });
  } catch (error) {
    res.status(500).json({
      error: { code: 'INTERNAL_ERROR', message: 'Registration failed' }
    });
  }
}

export async function login(req: Request, res: Response) {
  try {
    const { email, password } = req.body;

    // Find user
    const user = await prisma.user.findUnique({ where: { email } });
    if (!user) {
      return res.status(401).json({
        error: { code: 'INVALID_CREDENTIALS', message: 'Invalid email or password' }
      });
    }

    // Verify password
    const valid = await bcrypt.compare(password, user.password);
    if (!valid) {
      return res.status(401).json({
        error: { code: 'INVALID_CREDENTIALS', message: 'Invalid email or password' }
      });
    }

    // Generate token
    const token = generateToken({ userId: user.id });

    res.json({
      user: {
        id: user.id,
        email: user.email,
        name: user.name
      },
      token
    });
  } catch (error) {
    res.status(500).json({
      error: { code: 'INTERNAL_ERROR', message: 'Login failed' }
    });
  }
}
```

### Auth Routes

```typescript
// src/routes/auth.ts
import { Router } from 'express';
import { register, login } from '../controllers/authController';

const router = Router();

router.post('/register', register);
router.post('/login', login);

export default router;
```

### Protected Route Example

```typescript
// src/routes/users.ts
import { Router } from 'express';
import { authMiddleware } from '../middleware/auth';

const router = Router();

// Public route
router.get('/public', (req, res) => {
  res.json({ message: 'This is public' });
});

// Protected route
router.get('/profile', authMiddleware, (req, res) => {
  res.json({ user: req.user });
});

export default router;
```

---

## Next.js + Better Auth

For Next.js applications with modern authentication needs.

### Generated Files

```
lib/
├── auth.ts             # Better Auth configuration
└── auth-client.ts      # Client-side auth
app/
├── api/auth/[...all]/route.ts  # Auth API routes
└── (auth)/             # Auth pages (if generated)
components/
└── auth/               # Auth components
```

### Better Auth Configuration

```typescript
// lib/auth.ts
import { betterAuth } from "better-auth";
import { prismaAdapter } from "better-auth/adapters/prisma";
import { prisma } from "./prisma";

export const auth = betterAuth({
  database: prismaAdapter(prisma),
  emailAndPassword: {
    enabled: true,
  },
  socialProviders: {
    github: {
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    },
  },
});
```

### Auth Route Handler

```typescript
// app/api/auth/[...all]/route.ts
import { auth } from "@/lib/auth";

export const { GET, POST } = auth.handler;
```

### Client-Side Usage

```typescript
// lib/auth-client.ts
import { createAuthClient } from "better-auth/client";

export const authClient = createAuthClient();

// Usage in components
async function handleLogin(email: string, password: string) {
  const result = await authClient.signIn.email({
    email,
    password,
  });
  
  if (result.error) {
    console.error(result.error);
  } else {
    // Logged in successfully
    router.push('/dashboard');
  }
}
```

---

## Environment Variables

### Express JWT

```bash
JWT_SECRET="your-super-secret-key-min-32-chars"
JWT_EXPIRES_IN="7d"
```

### Better Auth

```bash
# Required
BETTER_AUTH_SECRET="your-secret-key"

# OAuth Providers (optional)
GITHUB_CLIENT_ID="your-github-client-id"
GITHUB_CLIENT_SECRET="your-github-client-secret"

GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"
```

---

## Security Best Practices

1. **Strong Secrets**: Use long, random strings for JWT_SECRET
2. **HTTPS Only**: Never use auth over HTTP in production
3. **Token Expiration**: Keep tokens short-lived (7 days max)
4. **Password Hashing**: Always use bcrypt (never store plain passwords)
5. **Rate Limiting**: Limit login attempts to prevent brute force
6. **Secure Cookies**: Use httpOnly, secure, sameSite flags

### Rate Limiting Example

```typescript
import rateLimit from 'express-rate-limit';

const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // 5 attempts
  message: {
    error: { code: 'RATE_LIMITED', message: 'Too many attempts, try again later' }
  }
});

app.use('/api/auth/', authLimiter);
```

<Callout type="warn">
  Always validate and sanitize user input. Never trust data from clients.
</Callout>
